<!DOCTYPE html>
<html>
    <head>
        <title>ARTS1422_HW1_Jinze_Shi</title>
        <script src = 'https://d3js.org/d3.v4.js'></script>
    </head>
    <body>
        <svg width = "2500" height = "1400" id = "mainsvg" class = "svgs"></svg> 
        <script>
            
            var margin = {top:20,right:20,left:20,bottom:20};
            var mainsvg = d3.select("#mainsvg");
            var width = +mainsvg.attr('width');
            var height = +mainsvg.attr('height');
            var innerWidth = width - margin.left - margin.right- margin.left - margin.right;
            var innerHeight = height - margin.top - margin.bottom;

            // 设置背景**************************************************************************************************************************************************
            mainsvg.append("rect")
                    .attr("y", 0)
                    .attr("x", 0)
                    .attr("width", width)
                    .attr("height", height)
                    .style("fill", 'black')
                    .attr('opacity')

            //设置边框**************************************************************************************************************************************************
            mainsvg.append("rect")
                    .attr("y", margin.top)
                    .attr("x", margin.left)
                    .attr("width", width-margin.top-margin.bottom)
                    .attr("height", height-margin.right-margin.left)
                    .style("fill", 'none')
                    .style('stroke','white')

            //显示标题**************************************************************************************************************************************************
            mainsvg.append("text")
            .attr("y", margin.top+40)
            .attr("x", margin.left + 950)
            .text("上海 2022 春季疫情可视化分析")
            .attr('font-size','2.5em').attr('fill','#3366cc').attr('stroke','none');

            mainsvg.append("line")
            .style("stroke", "white")
            .style("stroke-width", 1)
            .attr("x1", margin.left + 850)
            .attr("y1", margin.top+50)
            .attr("x2", margin.left + 1600)
            .attr("y2", margin.top+50);

            //显示日期**************************************************************************************************************************************************

            mainsvg.append("text")
            .attr("y", margin.top+90)
            .attr("x", margin.left + 240)
            .text("日期：")
            .attr('font-size','1。5em').attr('fill','white').attr('stroke','none');


            
            //显示新增确诊**************************************************************************************************************************************************

            mainsvg.append("text")
            .attr("y", margin.top+90)
            .attr("x", margin.left + 540)
            .text("新增确诊：")
            .attr('font-size','1em').attr('fill','white').attr('stroke','none');

            //显示累计确诊**************************************************************************************************************************************************

            mainsvg.append("text")
            .attr("y", margin.top+90)
            .attr("x", margin.left + 840)
            .text("累计确诊：")
            .attr('font-size','1em').attr('fill','white').attr('stroke','none');

            //显示新增无症状**************************************************************************************************************************************************

            mainsvg.append("text")
            .attr("y", margin.top+90)
            .attr("x", margin.left + 1140)
            .text("新增无症状：")
            .attr('font-size','1em').attr('fill','white').attr('stroke','none');

            //显示累计无症状**************************************************************************************************************************************************

            mainsvg.append("text")
            .attr("y", margin.top+90)
            .attr("x", margin.left + 1440)
            .text("累计无症状：")
            .attr('font-size','1em').attr('fill','white').attr('stroke','none');

            //显示确诊比例**************************************************************************************************************************************************

            mainsvg.append("text")
            .attr("y", margin.top+90)
            .attr("x", margin.left + 1740)
            .text("累计确诊比例 (%)：")
            .attr('font-size','1em').attr('fill','white').attr('stroke','none');

            //显示政策**************************************************************************************************************************************************

             //显示背景
            mainsvg.append("rect")
            .attr("y", 140)
            .attr("x", 50)
            .attr("width", 800)
            .attr("height", 100)
            .attr('stroke','#99ccff')
            .attr('opacity',.3)

            //显示政策文字

            mainsvg.append("text")
            .attr("y", 160)
            .attr("x", 60)
            .text("当日政策：")
            .attr('font-size','1em').attr('fill','white').attr('stroke','none');


            //显示地图可视化背景**************************************************************************************************************************************************

            mainsvg.append("rect")
            .attr("y", 250)
            .attr("x", 50)
            .attr("width", 800)
            .attr("height", 920)
            .style("fill", '#99ccff')
            .attr('opacity',.1)

            //显示左上

            mainsvg.append("line")
            .style("stroke", "white")
            .style("stroke-width", 1.5)
            .attr("x1", 50)
            .attr("y1",250)
            .attr("x2", 90)
            .attr("y2", 250);

            mainsvg.append("line")
            .style("stroke", "white")
            .style("stroke-width", 1.5)
            .attr("x1", 50)
            .attr("y1",250)
            .attr("x2", 50)
            .attr("y2", 290);

            //显示右上

            mainsvg.append("line")
            .style("stroke", "white")
            .style("stroke-width", 1.5)
            .attr("x1", 850)
            .attr("y1",250)
            .attr("x2", 810)
            .attr("y2", 250);

            mainsvg.append("line")
            .style("stroke", "white")
            .style("stroke-width", 1.5)
            .attr("x1", 850)
            .attr("y1",250)
            .attr("x2", 850)
            .attr("y2", 290);

            //显示右下

            mainsvg.append("line")
            .style("stroke", "white")
            .style("stroke-width", 1.5)
            .attr("x1", 850)
            .attr("y1",1170)
            .attr("x2", 810)
            .attr("y2", 1170);

            mainsvg.append("line")
            .style("stroke", "white")
            .style("stroke-width", 1.5)
            .attr("x1", 850)
            .attr("y1",1170)
            .attr("x2", 850)
            .attr("y2", 1130);

            //显示左下

            mainsvg.append("line")
            .style("stroke", "white")
            .style("stroke-width", 1.5)
            .attr("x1", 50)
            .attr("y1",1170)
            .attr("x2", 90)
            .attr("y2", 1170);

            mainsvg.append("line")
            .style("stroke", "white")
            .style("stroke-width", 1.5)
            .attr("x1", 50)
            .attr("y1",1170)
            .attr("x2", 50)
            .attr("y2", 1130);

            //显示各区比例**************************************************************************************************************************************************

            //显示边框

            mainsvg.append("rect")
            .attr("y", 1185)
            .attr("x", 50)
            .attr("width", 800)
            .attr("height", 160)
            .attr('stroke','#99ccff')
            .attr('opacity',.3)

            //显示轴
            var area =['虹口区','黄浦区','静安区','普陀区','杨浦区','徐汇区','长宁区','宝山区','闵行区','浦东新区','嘉定区','松江区','青浦区','奉贤区','金山区','崇明区']

            var area_scale = d3.scaleBand()
            .range([0, 800])
            .domain(area)
            .paddingInner(1.2)
            .paddingOuter(.8)

            var area_axis = d3.axisBottom(area_scale).tickSize(0)

            mainsvg.append("g").call(area_axis).selectAll(".tick text")
            .attr("fill","white")
            .attr('transform','translate(50,1320)')
            .attr('font-size','0.9em')
            .attr('fill','white').select('.domain').remove()

            mainsvg.append("line")
            .style("stroke", "white")
            .style("stroke-width", .5)
            .attr("x1", 50)
            .attr("y1",1310)
            .attr("x2", 850)
            .attr("y2", 1310);

            //显示标题

            mainsvg.append("text")
            .attr("y", 1210)
            .attr("x", 240)
            .text("各区管控区及社会面新增占比(%)")
            .attr('font-size','.8em').attr('fill','white').attr('stroke','none');


            //显示图例

            mainsvg.append("text")
            .attr("y", 1210)
            .attr("x", 440)
            .text("管控区：")
            .attr('font-size','.8em').attr('fill','white').attr('stroke','none');

            mainsvg.append("rect")
                    .attr("y", 1200)
                    .attr("x", 500)
                    .attr("width", 20)
                    .attr("height", 10)
                    .style("fill", '#99ccff')
                    .style('stroke','none')

            mainsvg.append("text")
            .attr("y", 1210)
            .attr("x", 540)
            .text("社会面：")
            .attr('font-size','.8em').attr('fill','white').attr('stroke','none');

            mainsvg.append("rect")
                    .attr("y", 1200)
                    .attr("x", 600)
                    .attr("width", 20)
                    .attr("height", 10)
                    .style("fill", '#ffff99')
                    .style('stroke','none')
            //显示备注
            mainsvg.append("text")
            .attr("y", 1360)
            .attr("x", 50)
            .text("*备注：区由人口密度从左到右依次递减，数据来源于2021")
            .attr('font-size','.4em').attr('fill','white').attr('stroke','none');


            //显示新增阳性，累计阳性折线图**************************************************************************************************************************************************
            //显示背景
            mainsvg.append("rect")
            .attr("y", 140)
            .attr("x", 880)
            .attr("width", 510)
            .attr("height", 250)
            .style("fill", 'none')
            .style('stroke','#99ccff')
            .style('opacity',.3)

             //显示底轴
            var date = ['3-11','3-16','3-21','3-26','3-31','4-5','4-11','4-16']
            var date_index = ["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47"]

            var date_scale = d3.scaleBand()
            .range([0, 490])
            .domain(date)
            .paddingInner(1.2)
            .paddingOuter(.8)

            var date_axis = d3.axisBottom(date_scale).tickSize(0)

            mainsvg.append("g").call(date_axis).selectAll(".tick text")
            .attr("fill","white")
            .attr('transform','translate(895,370)')
            .attr('font-size','0.9em')
            .attr('fill','white').select('.domain').remove()
      
            mainsvg.append("line")
                    .style("stroke", "white")
                    .style("stroke-width", .5)
                    .attr("x1", 920)
                    .attr("y1",365)
                    .attr("x2", 920+430)
                    .attr("y2", 365);

            //显示标题
            mainsvg.append("text")
            .attr("y", 170)
            .attr("x", 930)
            .text("新增总体和社会面阳性病例")
            .attr('font-size','.9em').attr('fill','white').attr('stroke','none');

            //显示图例
            mainsvg.append("text")
            .attr("y", 170)
            .attr("x", 1130)
            .text("总体")
            .attr('font-size','.9em').attr('fill','white').attr('stroke','none');

            mainsvg.append("line")
                    .style("stroke", "#3366cc")
                    .style("stroke-width", 1)
                    .attr("x1", 1180)
                    .attr("y1",165)
                    .attr("x2", 1180+30)
                    .attr("y2", 165);
            
            mainsvg.append("text")
                    .attr("y", 170)
                    .attr("x", 1230)
                    .text("社会(右)")
                    .attr('font-size','.9em').attr('fill','white').attr('stroke','none');
        
            mainsvg.append("line")
                        .style("stroke", "#ff6666")
                        .style("stroke-width", 1)
                        .attr("x1", 1300)
                        .attr("y1",165)
                        .attr("x2", 1300+30)
                        .attr("y2", 165); 
                        
            //显示纵轴
            mainsvg.append("line")
                    .style("stroke", "white")
                    .style("stroke-width", .5)
                    .attr("x1", 920)
                    .attr("y1",365)
                    .attr("x2", 920)
                    .attr("y2", 200)
                    .attr('opacity',.2)
            mainsvg.append("line")
                    .style("stroke", "white")
                    .style("stroke-width", .5)
                    .attr("x1", 920+430)
                    .attr("y1",365)
                    .attr("x2", 920+430)
                    .attr("y2", 200)
                    .attr('opacity',.2);

            

            //显示上海市累计阳性/治疗+观察**************************************************************************************************************************************************  
            //显示背景
            mainsvg.append("rect")
                    .attr("y", 140)
                    .attr("x", 1410)
                    .attr("width", 510)
                    .attr("height", 250)
                    .style("fill", 'none')
                    .style('stroke','#99ccff')
                    .style('opacity',.3)
            
            //显示底轴
            mainsvg.append("g").call(date_axis).selectAll(".tick text")
                    .attr("fill","white")
                    .attr('transform','translate(1425,370)')
                    .attr('font-size','0.9em')
                    .attr('fill','white').select('.domain').remove()

            mainsvg.append("line")
                    .style("stroke", "white")
                    .style("stroke-width", .5)
                    .attr("x1", 1450)
                    .attr("y1",365)
                    .attr("x2", 1450+430)
                    .attr("y2", 365);

            //显示标题
            mainsvg.append("text")
            .attr("y", 170)
            .attr("x", 1460)
            .text("累计阳性、累计治疗+观察")
            .attr('font-size','.9em').attr('fill','white').attr('stroke','none');

            //显示图例
            mainsvg.append("text")
            .attr("y", 170)
            .attr("x", 1660)
            .text("阳性")
            .attr('font-size','.9em').attr('fill','white').attr('stroke','none');

            mainsvg.append("line")
                    .style("stroke", "#3366cc")
                    .style("stroke-width", 1)
                    .attr("x1", 1710)
                    .attr("y1",165)
                    .attr("x2", 1710+30)
                    .attr("y2", 165);
            
            mainsvg.append("text")
                    .attr("y", 170)
                    .attr("x", 1760)
                    .text("在院(右)")
                    .attr('font-size','.9em').attr('fill','white').attr('stroke','none');
        
            mainsvg.append("line")
                        .style("stroke", "#ff6666")
                        .style("stroke-width", 1)
                        .attr("x1", 1830)
                        .attr("y1",165)
                        .attr("x2", 1830+30)
                        .attr("y2", 165);

            //显示纵轴
            mainsvg.append("line")
                    .style("stroke", "white")
                    .style("stroke-width", .5)
                    .attr("x1", 1450)
                    .attr("y1",365)
                    .attr("x2", 1450)
                    .attr("y2", 200)
                    .attr('opacity',.2)
            mainsvg.append("line")
                    .style("stroke", "white")
                    .style("stroke-width", .5)
                    .attr("x1", 1450+430)
                    .attr("y1",365)
                    .attr("x2", 1450+430)
                    .attr("y2", 200)
                    .attr('opacity',.2);



            
            //显示上海市四种人均gdp区域内的新增阳性数量**************************************************************************************************************************************************    
            //显示背景                
            mainsvg.append("rect")
                    .attr("y", 140)
                    .attr("x", 1940)
                    .attr("width", 510)
                    .attr("height", 250)
                    .style("fill", 'none')
                    .style('stroke','#99ccff')
                    .style('opacity',.3)

            //显示底轴

            mainsvg.append("g").call(date_axis).selectAll(".tick text")
                    .attr("fill","white")
                    .attr('transform','translate(1955,370)')
                    .attr('font-size','0.9em')
                    .attr('fill','white').select('.domain').remove()

            mainsvg.append("line")
                    .style("stroke", "white")
                    .style("stroke-width", .5)
                    .attr("x1", 1980)
                    .attr("y1",365)
                    .attr("x2", 1980+430)
                    .attr("y2", 365);

            //显示标题
            mainsvg.append("text")
            .attr("y", 170)
            .attr("x", 1950)
            .text("不同人均GDP区域新增情况")
            .attr('font-size','.9em').attr('fill','white').attr('stroke','none');

            //显示图例
            mainsvg.append("text")
            .attr("y", 170)
            .attr("x", 2130)
            .text(">20(左)")
            .attr('font-size','.8em').attr('fill','white').attr('stroke','none');

            mainsvg.append("line")
                    .style("stroke", "#ffcccc")
                    .style("stroke-width", 1)
                    .attr("x1", 2180)
                    .attr("y1",165)
                    .attr("x2", 2180+20)
                    .attr("y2", 165);

             mainsvg.append("text")
                    .attr("y", 170)
                    .attr("x", 2210)
                    .text("15-20")
                    .attr('font-size','.8em').attr('fill','white').attr('stroke','none');
        
            mainsvg.append("line")
                        .style("stroke", "#ff6666")
                        .style("stroke-width", 1)
                        .attr("x1", 2260)
                        .attr("y1",165)
                        .attr("x2", 2260+20)
                        .attr("y2", 165);
            
             mainsvg.append("text")
                        .attr("y", 170)
                        .attr("x", 2290)
                        .text("10-15")
                        .attr('font-size','.8em').attr('fill','white').attr('stroke','none');
            
            mainsvg.append("line")
                            .style("stroke", "#99ccff")
                            .style("stroke-width", 1)
                            .attr("x1", 2340)
                            .attr("y1",165)
                            .attr("x2", 2340+20)
                            .attr("y2", 165);    
                            
            mainsvg.append("text")
                            .attr("y", 170)
                            .attr("x", 2370)
                            .text("<10")
                            .attr('font-size','.8em').attr('fill','white').attr('stroke','none');
                
            mainsvg.append("line")
                                .style("stroke", "#3366cc")
                                .style("stroke-width", 1)
                                .attr("x1", 2410)
                                .attr("y1",165)
                                .attr("x2", 2410+20)
                                .attr("y2", 165);    
            //显示纵轴
            mainsvg.append("line")
                    .style("stroke", "white")
                    .style("stroke-width", .5)
                    .attr("x1", 1980)
                    .attr("y1",365)
                    .attr("x2", 1980)
                    .attr("y2", 200)
                    .attr('opacity',.2)
            mainsvg.append("line")
                    .style("stroke", "white")
                    .style("stroke-width", .5)
                    .attr("x1", 1980+430)
                    .attr("y1",365)
                    .attr("x2", 1980+430)
                    .attr("y2", 200)
                    .attr('opacity',.2);

            // 显示气泡图**************************************************************************************************************************************************
            //显示背景
            mainsvg.append("rect")
                    .attr("y", 410)
                    .attr("x", 880)
                    .attr("width", 790)
                    .attr("height", 935)
                    .style("fill", 'none')
                    .style('stroke','#99ccff')
                    .style('opacity',.3)

            //显示标题
            mainsvg.append("text")
                        .attr("y", 440)
                        .attr("x", 920)
                        .text("各区管控范围及社会面新增气泡图")
                        .attr('font-size','1em').attr('fill','white').attr('stroke','none');
            
            //显示图例
            
            mainsvg.append("text")
                        .attr("y", 440)
                        .attr("x", 1280)
                        .text("管控范围")
                        .attr('font-size','.9em').attr('fill','white').attr('stroke','none');

            mainsvg.append("circle")
                        .style("stroke", "none")
                        .style("fill", "#3366cc")
                        .attr('opacity','.4')
                        .attr("r", 8)
                        .attr("cx", 1230)
                        .attr("cy", 437)
            
            mainsvg.append("text")
                        .attr("y", 440)
                        .attr("x", 1420)
                        .text("社会范围")
                        .attr('font-size','.9em').attr('fill','white').attr('stroke','none');

            mainsvg.append("circle")
                        .style("stroke", "none")
                        .style("fill", "#ff6666")
                        .attr('opacity','.4')
                        .attr("r", 8)
                        .attr("cx", 1380)
                        .attr("cy", 437)

            mainsvg.append('rect')
                        .attr("y", 426)
                        .attr("x",1530)
                        .attr("width", 20)
                        .attr("height", 20)
                        .style("fill", '#99ccff')
                        .style('stroke','none')
                        .style('opacity',.15)

            mainsvg.append("text")
                        .attr("y", 440)
                        .attr("x", 1580)
                        .text("累计数量")
                        .attr('font-size','.9em').attr('fill','white').attr('stroke','none');


            //显示纵轴

            var area_scale = d3.scaleBand()
            .range([0,870])
            .domain(area)
            .paddingInner(1.2)
            .paddingOuter(.8)

            var area_axis = d3.axisLeft(area_scale).tickSize(0)

            mainsvg.append("g").call(area_axis).selectAll(".tick text")
            .attr("fill","white")
            .attr('transform','translate(930,450)')
            .attr('font-size','0.9em')
            .attr('fill','white').select('.domain').remove()

            for (var k=0;k<16;k++){

                mainsvg.append("line")
                    .style("stroke", "white")
                    .style("stroke-width", .5)
                    .attr("x1", 940)
                    .attr("y1",450+area_scale(area[k])-10)
                    .attr("x2", 940+700)
                    .attr("y2", 450+area_scale(area[k])-10)
                    .attr('opacity',.2);

                mainsvg.append("line")
                    .style("stroke", "white")
                    .style("stroke-width", .5)
                    .attr("x1", 940)
                    .attr("y1",450+area_scale(area[k])+10)
                    .attr("x2", 940+700)
                    .attr("y2", 450+area_scale(area[k])+10)
                    .attr('opacity',.2);
            }

            //显示横轴

            var date_scale = d3.scaleBand()
            .range([0, 1570])
            .domain(date)
            .paddingInner(1.2)
            .paddingOuter(.8)


            var date_axis = d3.axisBottom(date_scale).tickSize(0)

           // mainsvg.append("g").call(date_axis).selectAll(".tick text")
            //.attr("fill","white")
            //.attr('transform','translate(940,915)')
            //.attr('font-size','0.9em')
            //.attr('fill','white').select('.domain').remove()



            // 显示统计分析**************************************************************************************************************************************************

            mainsvg.append("text")
                        .attr("y", 430)
                        .attr("x", 1900)
                        .text("统")
                        .attr('font-size','1.5em')
                        .attr('fill','#3366cc')
                        .attr('stroke','none')
                        .attr('opacity','.8');
            
            mainsvg.append("text")
                        .attr("y", 430)
                        .attr("x", 2000)
                        .text("计")
                        .attr('font-size','1.5em')
                        .attr('fill','#3366cc')
                        .attr('stroke','none')
                        .attr('opacity','.8');
                
            mainsvg.append("text")
                        .attr("y", 430)
                        .attr("x", 2100)
                        .text("分")
                        .attr('font-size','1.5em')
                        .attr('fill','#3366cc')
                        .attr('stroke','none')
                        .attr('opacity','.8');
            
            mainsvg.append("text")
                        .attr("y", 430)
                        .attr("x", 2200)
                        .text("析")
                        .attr('font-size','1.5em')
                        .attr('fill','#3366cc')
                        .attr('stroke','none')
                        .attr('opacity','.8');

            mainsvg.append("line")
                        .style("stroke", "white")
                        .style("stroke-width", 1)
                        .attr("x1", 1700)
                        .attr("y1",420)
                        .attr("x2", 1880)
                        .attr("y2", 420)
                        .attr('opacity',.5);

            mainsvg.append("line")
                        .style("stroke", "white")
                        .style("stroke-width", 1)
                        .attr("x1", 2250)
                        .attr("y1",420)
                        .attr("x2", 2430)
                        .attr("y2", 420)
                        .attr('opacity',.5);

            
            // 显示性别及年龄分析**************************************************************************************************************************************************

            mainsvg.append("rect")
                    .attr("y", 450)
                    .attr("x", 1690)
                    .attr("width", 290)
                    .attr("height", 480)
                    .style("fill", 'none')
                    .style('stroke','#99ccff')
                    .style('opacity',.3)
            mainsvg.append("text")
                    .attr("y", 910)
                    .attr("x", 1770)
                    .text("性别比例及年龄分布")
                    .attr('font-size','.9em')
                    .attr('fill','white')
                    .attr('stroke','none');

            // 显示各区疫情发展相关性**************************************************************************************************************************************************

            mainsvg.append("rect")
                    .attr("y", 450)
                    .attr("x", 2000)
                    .attr("width", 450)
                    .attr("height", 480)
                    .style("fill", 'none')
                    .style('stroke','#99ccff')
                    .style('opacity',.3)
            mainsvg.append("text")
                    .attr("y", 895)
                    .attr("x", 2170)
                    .text("各区疫情发展相关性")
                    .attr('font-size','.9em')
                    .attr('fill','white')
                    .attr('stroke','none')
                    mainsvg.append("text")
                    .attr("y", 920)
                    .attr("x", 2100)
                    .text("(右上半部分：总新增阳性，左下半部分：社会面新增阳性)")
                    .attr('font-size','.7em')
                    .attr('fill','white')
                    .attr('stroke','none');

            // 显示各区阳性率热图**************************************************************************************************************************************************

            mainsvg.append("rect")
                    .attr("y", 950)
                    .attr("x", 1690)
                    .attr("width", 290)
                    .attr("height", 400)
                    .style("fill", 'none')
                    .style('stroke','#99ccff')
                    .style('opacity',.3)
            mainsvg.append("text")
                    .attr("y", 1330)
                    .attr("x", 1780)
                    .text("各区阳性率分析")
                    .attr('font-size','.9em')
                    .attr('fill','white')
                    .attr('stroke','none');

            // 显示补充分析**************************************************************************************************************************************************

            mainsvg.append("rect")
                    .attr("y", 950)
                    .attr("x", 2000)
                    .attr("width", 450)
                    .attr("height", 400)
                    .style("fill", 'none')
                    .style('stroke','#99ccff')
                    .style('opacity',.3)

            mainsvg.append("text")
                    .attr("y", 1340)
                    .attr("x", 2150)
                    .text("待补充")
                    .attr('font-size','.9em')
                    .attr('fill','white')
                    .attr('stroke','none');

             // 显示静态数据**************************************************************************************************************************************************

             // 显示气泡数据**************************************************************************************************************************************************
             
             
             d3.csv("https://raw.githubusercontent.com/shijinze2000/ARTS1422/main/buble.csv",function(data){

                var index = ['1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16']
                var date_index = ["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45",'46','47']
                var area =['浦东新区','黄浦区','徐汇区','长宁区','静安区','普陀区','虹口区','杨浦区','闵行区','宝山区','嘉定区','金山区','松江区','青浦区','奉贤区','崇明区']

                var data_guankong = new Array
                var data_fengxian = new Array
                var data_bili = new Array

                var Total_day = 47


                var date_index_scale2 = d3.scalePow().exponent(2)
                .domain([1,Total_day])
                .range([0, 700])

               
                for (var n=0;n<Total_day;n++){
                    data_guankong.push(data[n])
                    data_fengxian.push(data[Total_day+n])
                }
                data_bili.push(data[2*Total_day])

                
                for(var m=0;m<16;m++){
                    mainsvg.append('rect')
                    .attr("y", 430+area_scale(area[m]))
                    .attr("x", 940)
                    .attr("width", data_bili[0][index[m]]/400)
                    .attr("height", 40)
                    .style("fill", '#99ccff')
                    .style('stroke','none')
                    .style('opacity',.25)
                    for(var n=0;n<Total_day;n++){

                    mainsvg.append("circle")
                        .style("stroke", "none")
                        .style("fill", "#3366cc")
                        .attr('opacity','.5')
                        .attr("r", 1.5*data_guankong[n][index[m]])
                        .attr("cx", 940+date_index_scale2(date_index[n]))
                        .attr("cy", 450+area_scale(area[m])-10)
                    
                    mainsvg.append("circle")
                        .style("stroke", "none")
                        .style("fill", "#ff6666")
                        .attr('opacity','.5')
                        .attr("r", 1.5*data_fengxian[n][index[m]])
                        .attr("cx", 940+date_index_scale2(date_index[n]))
                        .attr("cy", 450+area_scale(area[m])+10)

                    }
                    
                }


             })

            // 显示热图数据**************************************************************************************************************************************************
            d3.csv("https://raw.githubusercontent.com/shijinze2000/ARTS1422/main/hot.csv",function(data){

                var index = ['1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16']
                var data_hot = new Array
                data_hot.push(data[0])
                data_hot.push(data[1])
                data_hot.push(data[2])

                var colorScale = d3.scaleSequential(d3.interpolate("rgb(51,102,204)", "rgb(255,102,102)"))
    .domain([0,0.05])
      
                var area_hot =['黄浦','浦东','徐汇','闵行','虹口','长宁','杨浦','静安','普陀','宝山','嘉定','松江','青浦','崇明','奉贤','金山']

                var density = d3.scaleLinear()
                .domain([0,4])
                .range([0, 120])

                var density2 = d3.scaleBand()
                .domain(['0.0','2.0','4.0'])
                .range([0, 120])

                var gdp = d3.scaleLinear()
                .domain([0,60])
                .range([0, 120])

                var gdp2 = d3.scaleBand()
                .domain(['0.0','20.0','40.0','60.0'])
                .range([0, 120])


                var positive_rate = d3.scaleLinear()
                .domain([0,0.05])
                .range([0, 250])
                
                var positive_rate2 = d3.scaleLinear()
                .domain([0.05,0])
                .range([0, 250])

                var density_axis = d3.axisBottom(density2).tickSize(0.1)



                mainsvg.append("g").call(density_axis).selectAll("text")
                .attr("fill","white")
                .attr('transform','translate(1710,1290),rotate(-35)')
                .attr('font-size','0.6em')
                .attr('fill','white')

                var gdp_axis = d3.axisBottom(gdp2).tickSize(0.1)

                mainsvg.append("g").call(gdp_axis).selectAll("text")
                .attr("fill","white")
                .attr('transform','translate(1840,1290),rotate(-35)')
                .attr('font-size','0.6em')
                .attr('fill','white')

                var positive_rate_axis = d3.axisLeft(positive_rate2).tickSize(0.1)

                mainsvg.append("g").call(positive_rate_axis).selectAll("text")
                .attr("fill","white")
                .attr('transform','translate(1715,1020),rotate(-35)')
                .attr('font-size','0.6em')
                .attr('fill','white')

                mainsvg.append("g").call(positive_rate_axis).selectAll("text")
                .attr("fill","white")
                .attr('transform','translate(1850,1020),rotate(-35)')
                .attr('font-size','0.6em')
                .attr('fill','white')

                for(var i=0;i<6;i++){

                    mainsvg.append("line")
                        .style("stroke", "white")
                        .style("stroke-width", .5)
                        .attr("x1", 1850+gdp(i*10))
                        .attr("y1",1020)
                        .attr("x2", 1850+gdp(i*10))
                        .attr("y2", 1290)
                        .attr('opacity',.2);

                    mainsvg.append("line")
                        .style("stroke", "white")
                        .style("stroke-width", .5)
                        .attr("x1", 1720+gdp(i*10))
                        .attr("y1",1020)
                        .attr("x2", 1720+gdp(i*10))
                        .attr("y2", 1290)
                        .attr('opacity',.2);

                    mainsvg.append("line")
                        .style("stroke", "white")
                        .style("stroke-width", .5)
                        .attr("x1", 1720)
                        .attr("y1",1020+positive_rate(i/100))
                        .attr("x2", 1820)
                        .attr("y2", 1020+positive_rate(i/100))
                        .attr('opacity',.2);

                    mainsvg.append("line")
                        .style("stroke", "white")
                        .style("stroke-width", .5)
                        .attr("x1", 1850)
                        .attr("y1",1020+positive_rate(i/100))
                        .attr("x2", 1950)
                        .attr("y2", 1020+positive_rate(i/100))
                        .attr('opacity',.2);                  
                    
                    
                    
                    }

                for(var i=0;i<16;i++){

                    mainsvg.append("circle")
                        .style("stroke", "none")
                        .style("fill", "#3366cc")
                        .attr('opacity','.5')
                        .attr("r", 5)
                        .attr("cx", 1720+density(data_hot[1][index[i]]))
                        .attr("cy", 1270-positive_rate(data_hot[0][index[i]]))


                    mainsvg.append("circle")
                        .style("stroke", "none")
                        .style("fill", "#3366cc")
                        .attr('opacity','.95')
                        .attr("r", 2)
                        .attr("cx", 1720+density(data_hot[1][index[i]]))
                        .attr("cy", 1270-positive_rate(0.0054*data_hot[1][index[i]]+0.0076))


                    mainsvg.append("circle")
                        .style("stroke", "none")
                        .style("fill", "#ff6666")
                        .attr('opacity','.5')
                        .attr("r", 5)
                        .attr("cx", 1850+gdp(data_hot[2][index[i]]))
                        .attr("cy", 1270-positive_rate(data_hot[0][index[i]]))


                    mainsvg.append("circle")
                        .style("stroke", "none")
                        .style("fill", "#ff6666")
                        .attr('opacity','.5')
                        .attr("r", 2)
                        .attr("cx", 1850+gdp(data_hot[2][index[i]]))
                        .attr("cy", 1270-positive_rate(0.001*data_hot[2][index[i]]+0.0023))

                }

                for(var i=0;i<15;i++){

                    mainsvg.append("line")
                        .style("stroke", "#3366cc")
                        .style("stroke-width", .5)
                        .attr("x1", 1720+density(data_hot[1][index[i]]))
                        .attr("y1",1270-positive_rate(0.0054*data_hot[1][index[i]]+0.0076))
                        .attr("x2",1720+density(data_hot[1][index[i+1]]))
                        .attr("y2", 1270-positive_rate(0.0054*data_hot[1][index[i+1]]+0.0076))
                        .attr('opacity',.95);
                    mainsvg.append("line")
                        .style("stroke", "#ff6666")
                        .style("stroke-width", .5)
                        .attr("x1", 1850+gdp(data_hot[2][index[i]]))
                        .attr("y1",1270-positive_rate(0.001*data_hot[2][index[i]]+0.0023))
                        .attr("x2",1850+gdp(data_hot[2][index[i+1]]))
                        .attr("y2", 1270-positive_rate(0.001*data_hot[2][index[i+1]]+0.0023))
                        .attr('opacity',.95);

                }

                mainsvg.append("text")
                .attr("y", 1010)
                .attr("x", 1720)
                .text("各区阳性率与人口密度回归")
                .attr('font-size','.6em')
                .attr('fill','white')
                .attr('stroke','none');


                mainsvg.append("text")
                .attr("y", 1010)
                .attr("x", 1850)
                .text("各区阳性率与人均GDP回归")
                .attr('font-size','.6em')
                .attr('fill','white')
                .attr('stroke','none');

                for(var i=0;i<16;i++){

                    mainsvg.append('rect')
                    .attr("y", 965)
                    .attr("x", 1700+i*17)
                    .attr("width", 16)
                    .attr("height", 25)
                    .style("fill", colorScale(0.05-data_hot[0][index[i]]))
                    .style('stroke','none')
                    .style('opacity',.6)

                    mainsvg.append("text")
                    .attr("y", 974)
                    .attr("x", 1702+i*17)
                    .text(area_hot[15-i])
                    .attr('font-size','.4em')
                    .attr('fill','white')
                    .attr('stroke','none');

                    percent = data_hot[0][index[15-i]]*100
                    percent = percent.toFixed(1)
                    mainsvg.append("text")
                    .attr("y", 985)
                    .attr("x", 1702+i*17)
                    .text(percent.toString()+'%')
                    .attr('font-size','.3em')
                    .attr('fill','white')
                    .attr('stroke','none');


                }

                mainsvg.append("text")
                    .attr("y", 1360)
                    .attr("x", 1700)
                    .text('*备注：GDP为人均GDP，单位万元/人，人口密度单位：万人/平方公里')
                    .attr('font-size','.3em')
                    .attr('fill','white')
                    .attr('stroke','none');

            })

            //显示折线图**************************************************************************************************************************************************

            d3.csv("https://raw.githubusercontent.com/shijinze2000/ARTS1422/main/time.csv",function(data){

                var days = 47

                var index = ['1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16']
                var date_index = ["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47"]

                var data_total = new Array
                var data_society = new Array
                var positive = new Array
                var hospital = new Array
                var threapy_rate = new Array
                var new_gdp = new Array


                data_total.push(data[0])
                data_society.push(data[1])
                threapy_rate.push(data[2])
                positive.push(data[3])
                hospital.push(data[4])

                for (var n=5;n<9;n++){
                    new_gdp.push(data[n])
                }

                var axis_total = d3.scaleBand().domain(['0','7000','14000','21000','28000']).range([200,0])
                var axis_total2 = d3.scaleLinear().domain([0,28000]).range([170,0])
                var axis_society = d3.scaleBand().domain(['0','350','700','1050','1400']).range([200,0])
                var axis_society2 = d3.scaleLinear().domain([0,1400]).range([170,0])
                var axis_positive = d3.scaleBand().domain(['0','115000','230000','345000','460000']).range([200,0])
                var axis_positive2 = d3.scaleLinear().domain([0,460000]).range([170,0])
                var new_gdp1 = d3.scaleBand().domain(['0','4500','9000','13500','18000']).range([200,0])
                var new_gdp12 = d3.scaleLinear().domain([0,18000]).range([170,0])
                var new_gdp2 = d3.scaleBand().domain(['0','2000','4000','6000','8000']).range([200,0])
                var new_gdp22 = d3.scaleLinear().domain([0,8000]).range([170,0])

                var axis_total = d3.axisLeft(axis_total).tickSize(0.1)
                var axis_society = d3.axisRight(axis_society).tickSize(0.1)
                var axis_positive = d3.axisLeft(axis_positive).tickSize(0.1)
                var new_gdp1 = d3.axisLeft(new_gdp1).tickSize(0.1)
                var new_gdp2 = d3.axisRight(new_gdp2).tickSize(0.1)

                mainsvg.append("g").call(axis_total).selectAll("text")
                .attr("fill","white")
                .attr('transform','translate(920,180),rotate(0)')
                .attr('font-size','0.8em')
                .attr('fill','white')

                mainsvg.append("g").call(axis_society).selectAll("text")
                .attr("fill","white")
                .attr('transform','translate(1350,180),rotate(0)')
                .attr('font-size','0.8em')
                .attr('fill','white')

                mainsvg.append("g").call(axis_positive).selectAll("text")
                .attr("fill","white")
                .attr('transform','translate(1450,180),rotate(0)')
                .attr('font-size','0.8em')
                .attr('fill','white')

                mainsvg.append("g").call(new_gdp1).selectAll("text")
                .attr("fill","white")
                .attr('transform','translate(1980,180),rotate(0)')
                .attr('font-size','0.8em')
                .attr('fill','white')

                mainsvg.append("g").call(new_gdp2).selectAll("text")
                .attr("fill","white")
                .attr('transform','translate(2410,180),rotate(0)')
                .attr('font-size','0.8em')
                .attr('fill','white')

                var date_scale = d3.scaleBand()
                .range([0, 430])
                .domain(date_index)

                for (var i=0;i<days;i++){

                    mainsvg.append("circle")
                        .style("stroke", "none")
                        .style("fill", "#3366cc")
                        .attr('opacity','.5')
                        .attr("r", 2)
                        .attr("cx", 925+date_scale(date_index[i]))
                        .attr("cy", 190+axis_total2(data_total[0][date_index[i]]))

                    mainsvg.append("circle")
                        .style("stroke", "none")
                        .style("fill", "#ff6666")
                        .attr('opacity','.5')
                        .attr("r", 2)
                        .attr("cx", 925+date_scale(date_index[i]))
                        .attr("cy", 190+axis_society2(data_society[0][date_index[i]]))

                    mainsvg.append("circle")
                        .style("stroke", "none")
                        .style("fill", "#3366cc")
                        .attr('opacity','.5')
                        .attr("r", 2)
                        .attr("cx", 1450+date_scale(date_index[i]))
                        .attr("cy", 190+axis_positive2(positive[0][date_index[i]]))

                    mainsvg.append("circle")
                        .style("stroke", "none")
                        .style("fill", "#ff6666")
                        .attr('opacity','.5')
                        .attr("r", 60*threapy_rate[0][date_index[i]])
                        .attr("cx", 1450+date_scale(date_index[i]))
                        .attr("cy", 190+axis_positive2(hospital[0][date_index[i]]))
                    
                    mainsvg.append("circle")
                        .style("stroke", "none")
                        .style("fill", "#ffcccc")
                        .attr('opacity','.5')
                        .attr("r", 2)
                        .attr("cx", 1980+date_scale(date_index[i]))
                        .attr("cy", 190+new_gdp12(new_gdp[0][date_index[i]]))
                    
                        mainsvg.append("circle")
                        .style("stroke", "none")
                        .style("fill", "#ff6666")
                        .attr('opacity','.5')
                        .attr("r", 2)
                        .attr("cx", 1980+date_scale(date_index[i]))
                        .attr("cy", 190+new_gdp22(new_gdp[1][date_index[i]]))

                        mainsvg.append("circle")
                        .style("stroke", "none")
                        .style("fill", "#99ccff")
                        .attr('opacity','.5')
                        .attr("r", 2)
                        .attr("cx", 1980+date_scale(date_index[i]))
                        .attr("cy", 190+new_gdp22(new_gdp[2][date_index[i]]))

                        mainsvg.append("circle")
                        .style("stroke", "none")
                        .style("fill", "#3366cc")
                        .attr('opacity','.5')
                        .attr("r", 2)
                        .attr("cx", 1980+date_scale(date_index[i]))
                        .attr("cy", 190+new_gdp22(new_gdp[3][date_index[i]]))
                }

                for (var i=0;i<days-1;i++){

                    mainsvg.append("line")
                        .style("stroke", "#3366cc")
                        .style("stroke-width", 1)
                        .attr("x1", 925+date_scale(date_index[i]))
                        .attr("y1",190+axis_total2(data_total[0][date_index[i]]))
                        .attr("x2",925+date_scale(date_index[i+1]))
                        .attr("y2",190+axis_total2(data_total[0][date_index[i+1]]))
                        .attr('opacity',.5);
                    mainsvg.append("line")
                        .style("stroke", "#ff6666")
                        .style("stroke-width", 1)
                        .attr("x1", 925+date_scale(date_index[i]))
                        .attr("y1",190+axis_society2(data_society[0][date_index[i]]))
                        .attr("x2",925+date_scale(date_index[i+1]))
                        .attr("y2", 190+axis_society2(data_society[0][date_index[i+1]]))
                        .attr('opacity',.5);

                    mainsvg.append("line")
                        .style("stroke", "#3366cc")
                        .style("stroke-width", 1)
                        .attr("x1", 1450+date_scale(date_index[i]))
                        .attr("y1",190+axis_positive2(positive[0][date_index[i]]))
                        .attr("x2",1450+date_scale(date_index[i+1]))
                        .attr("y2",190+axis_positive2(positive[0][date_index[i+1]]))
                        .attr('opacity',.5);

                    mainsvg.append("line")
                        .style("stroke", "#ff6666")
                        .style("stroke-width", 1)
                        .attr("x1", 1450+date_scale(date_index[i]))
                        .attr("y1",190+axis_positive2(hospital[0][date_index[i]]))
                        .attr("x2",1450+date_scale(date_index[i+1]))
                        .attr("y2", 190+axis_positive2(hospital[0][date_index[i+1]]))
                        .attr('opacity',.5);


                        mainsvg.append("line")
                        .style("stroke", "#ffcccc")
                        .style("stroke-width", 1)
                        .attr("x1", 1980+date_scale(date_index[i]))
                        .attr("y1",190+new_gdp12(new_gdp[0][date_index[i]]))
                        .attr("x2",1980+date_scale(date_index[i+1]))
                        .attr("y2", 190+new_gdp12(new_gdp[0][date_index[i+1]]))
                        .attr('opacity',.5);

                        mainsvg.append("line")
                        .style("stroke", "#ff6666")
                        .style("stroke-width", 1)
                        .attr("x1", 1980+date_scale(date_index[i]))
                        .attr("y1",190+new_gdp22(new_gdp[1][date_index[i]]))
                        .attr("x2",1980+date_scale(date_index[i+1]))
                        .attr("y2", 190+new_gdp22(new_gdp[1][date_index[i+1]]))
                        .attr('opacity',.5);

                        mainsvg.append("line")
                        .style("stroke", "#99ccff")
                        .style("stroke-width", 1)
                        .attr("x1", 1980+date_scale(date_index[i]))
                        .attr("y1",190+new_gdp22(new_gdp[2][date_index[i]]))
                        .attr("x2",1980+date_scale(date_index[i+1]))
                        .attr("y2", 190+new_gdp22(new_gdp[2][date_index[i+1]]))
                        .attr('opacity',.5);

                        mainsvg.append("line")
                        .style("stroke", "#3366cc")
                        .style("stroke-width", 1)
                        .attr("x1", 1980+date_scale(date_index[i]))
                        .attr("y1",190+new_gdp22(new_gdp[3][date_index[i]]))
                        .attr("x2",1980+date_scale(date_index[i+1]))
                        .attr("y2", 190+new_gdp22(new_gdp[3][date_index[i+1]]))
                        .attr('opacity',.5);
                }
                

            })

            //显示相关性**************************************************************************************************************************************************
            d3.csv("https://raw.githubusercontent.com/shijinze2000/ARTS1422/main/corr.csv",function(data){

            var area =['浦东','黄浦','徐汇','长宁','静安','普陀','虹口','杨浦','闵行','宝山','嘉定','金山','松江','青浦','奉贤','崇明']
            var index = ['1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16']

            var colorScale = d3.scaleSequential(d3.interpolate("rgb(51,102,204)", "rgb(255,102,102)"))
    .domain([-0.1,0.95])

             var corr_data = new Array
             for (var i=0;i<16;i++){
                corr_data.push(data[i])
             }
             
             
           

            var area_corr_axis = d3.scaleBand().domain(area).range([0,400]).paddingInner(1.2)
            .paddingOuter(.9)
            var area_corr_axis2 = d3.scaleLinear().domain([1,16]).range([0,400])

            var area_corr_axis_horizontal = d3.axisBottom(area_corr_axis).tickSize(0.1)
            var area_corr_axis_vertical = d3.axisLeft(area_corr_axis).tickSize(0.1)


            mainsvg.append("g").call(area_corr_axis_horizontal).selectAll("text")
                .attr("fill","white")
                .attr('transform','translate(2040,480),rotate(0)')
                .attr('font-size','0.8em')
                .attr('fill','white')

                mainsvg.append("g").call(area_corr_axis_vertical).selectAll("text")
                .attr("fill","white")
                .attr('transform','translate(2050,480),rotate(0)')
                .attr('font-size','0.8em')
                .attr('fill','white')



            for (var i=0;i<16;i++){
                for (var j=1;j<17;j++){

                    mainsvg.append('rect')
                    .attr("y", 495+23.7*i)
                    .attr("x", 2030+23.7*j)
                    .attr("width", 20)
                    .attr("height", 20)
                    .style("fill", colorScale(corr_data[i][j.toString()]))
                    .style('stroke','none')
                    .style('opacity',.6)

                }}
            
            
            })

            // 交互部分

            d3.csv("https://raw.githubusercontent.com/shijinze2000/ARTS1422/main/interaction.csv",function(data){

                        var interaction_data = new Array
                        var days = 47

                        for (var i=0;i<days;i++){
                            interaction_data.push(data[i])
                         } 

                        // 预设

                        // 日期
                        date_month = interaction_data[0]['1']
                        date_day = interaction_data[0]['2']
                        mainsvg.append("text")
                        .attr("y", 113)
                        .attr("x", 350)
                        .text(date_month.toString()+' 月 '+date_day.toString()+' 日 ')
                        .attr('font-size','1.5em')
                        .attr('fill','#ff6666')
                        .attr('stroke','none');

                        //新增


                        //显示上三角

                        var uptriangle = d3.symbol().type(d3.symbolTriangle).size(100)

                        mainsvg.append("path")
                        .attr('d',uptriangle)
                        .attr('fill','#99ccff')
                        .attr('transform','translate(500,95)')
            
                        //显示下三角
            
                        var downtriangle = d3.symbol().type(d3.symbolTriangle).size(100)
                        
                        mainsvg.append("path")
                        .attr('d',downtriangle)
                        .attr('fill','#99ccff')
                        .attr('transform','translate(500,115) rotate(180) ')

                    })
            
        </script>
</body>
</html>
